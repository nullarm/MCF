\documentclass[a4paper,10pt]{article}

\usepackage[]{textcomp}
\usepackage{hyperref}
% Title Page

\title{User Guide of multiscale complex fluids simulation~(MCF) code}
\author{Xin Bian}


\begin{document}
\maketitle

\tableofcontents

\begin{abstract}
\end{abstract}

\section{Introduction}
A code named multiscale complex fluids simulation~(MCF)
has been developed and is still being developed in
Marco Ellero's Emmy Noether group
at Prof. Adams' Chair of Aerodynamics,
Technical University Munich.
This article is created
to facilitate usage of the code,
which is written in Fortran 90 and
uses a highly efficient parallel particle mesh~(PPM)\cite{Sbalzarini2006} library.
The numerical algorithme of MCF is based on
mesh free Lagrangian particle method,
particularly smoothed particle hydrodynamics~(SPH)
and its extended version smoothed dissipative particle dynamics~(SDPD).

\section{Compiling}

\subsection{Parallel particle mesh library}
\url{http://chaton.inf.ethz.ch/ppm/index.php/Main_Page}
\cite{Sbalzarini2006}.
\subsection{Multiscale complex fluids simulation}

\subsection{Punto}
A easy use visulization tool.

\subsection{Paraview with particles}

\section{Input configuration files}
There are three input configuration files
located in \textit{\$/mcf/mcf\_config/} directory,
i.e., \textbf{mcf\_ctrl\_config\_file}, 
\textbf{mcf\_physics\_config\_file}
and \textbf{mcf\_io\_config\_file}.
Their default names are
\textit{ctrl.mcf}, \textit{physics\_config.mcf} and
\textit{io\_config.mcf}.
For people who are familiar with SPH
or even general Lagrangian particle method,
such as molecular dynamics~(MD),
there should be no difficulty in using MCF code
following the comments in these three input files.
To have a complete explaination,
we describe all the parameters here.
Maybe some of the text here are redundant,
since it is basically an extended version of the comments
of the three input files.
Parameters' names are always in \textbf{bold}
and their values are always in \textit{italic}.

\subsection{\textbf{mcf\_ctrl\_config\_file}~(\textit{ctrl.mcf})}
Before running the  simulation,
this file should be always the first file
checked by the user.
It includes definitions of the fundamental components of MCF.
The name \textit{ctrl.mcf} is hard coded in MCF.
If one wants to use another control file \textit{FILE},
he can start MCF with a parameter in command line, 
i.e., \$ ./mcf \textit{FILE}.
Note \textit{FILE} must include all 
the parameter explained below.
\begin{itemize}
\item
\textbf{mcf\_io\_config\_file}\\
File name of IO information input file.\\
Default is \textit{io\_config.mcf}.

\item
\textbf{mcf\_physics\_config\_file}\\
File name of physics information input file.\\
Default is \textit{physics\_config.mcf}.

\item
\textbf{debug\_flag}\\
If the simulation runs in debug mode~(MCF compiled with debug flag),
this parameter determines the level of debug,
the higher, the more extensive.
Default is \textit{1}.

\item
\textbf{relax\_run}\\
If particles' positions needed to be 
relaxed or randomized from the initial lattice,
set this value to \textit{TRUE},
then MCF will use SDPD to pre-run.
In this case, \textbf{relax\_type} etc. in
\textbf{mcf\_physics\_config\_file} file 
should be set accordingly.

\item
\textbf{read\_external}\\
If MCF needs to read particles' configurations externally,
this value is set to be \textit{TRUE};
It includes particles' configuration
\textit{(x, v, rho, m, p\_id, s\_id)} and
conformation tensor(for Non-Newtonian oldroyd-B fluid).
IO parameters in \textbf{mcf\_io\_config\_file} file have to be set accordingly.

For \textit{FALSE}, particles are completely generated by MCF.

\item
\textbf{rhs\_density\_type} \\
Formulation of right hand side~(RHS) for density.
\begin{itemize}
 \item \textit{1} Summation formulation of physical density\cite{Monaghan1992}.
 \item \textit{2} Summation formulation of number density\cite{Espanol2003}.
 \item \textit{3} Integration formulation of physical density\cite{Monaghan1992}\cite{Morris1997} 
       in continuity equation (not available).
\end{itemize}

\item
\textbf{rhs\_force\_type} \\
Formulation of RHS for force.
\begin{itemize}
 \item \textit{1} Morris J.P. et al. \cite{Morris1997}
 \item \textit{2} Espa\~{n}ol P. and  Revenga M. \cite{Espanol2003}
 \item \textit{3} Hu XY and Adams N.~A.  \cite{Hu2006a}.
\end{itemize}

\item
\textbf{dynamic\_density\_ref}\\
To subtract backgroud pressure,
one needs to use reference density.
If this variable is set to be \textit{TRUE},
the reference density will be calculated dynamically,
which means \textbf{$\rho_{ref}$} is always the minimum
density at every step.
This should not be used unnessarily,
since it needs communication between processors
to determine minimum density.

For \textit{FALSE}, \textbf{$\rho_{ref}$} will be given
in \textbf{mcf\_physics\_config\_file} file.

\item
\textbf{stateEuqation\_type}\\
Type of state equation.
\begin{itemize}
 \item \textit{1} $p=c_s^2(\rho-\rho_{ref})$ 
 \cite{Morris1997}
 \item \textit{2} $p=p_0\left(\left(\frac{\rho}{\rho_{ref}}\right)^{\gamma}-1 \right)$
 \cite{Monaghan1994}
\end{itemize}

\item
\textbf{kernel\_type}\\
Type of kernel being used.

\begin{itemize}
 \item \textit{1} Quintic Spline~\cite{Morris1997}.
 \item \textit{2} Lucy kernel~\cite{Lucy1977}.
 \item \textit{3} B-Spline~(not available).
\end{itemize}

\item
\textbf{integrate\_type}\\
Time integration scheme.
\begin{itemize}
 \item \textit{1} Explicit Euler.
 \item \textit{2} Modified velocity Verlet~\cite{Groot1997}.
\end{itemize}

\item
\textbf{symmetry}\\
Set this to \textit{TRUE} if use symmetry 
inter-processor communiction and
inter-particle interaction;
\textit{FALSE} otherwise.

\item
\textbf{flow\_v\_fixed}\\
\textit{TRUE}: 
In-flow velocity is kept as a constant value
by adjusting body force dynamically.
Set \textbf{flow\_direction} etc. parameters in
\textbf{mcf\_io\_config\_file} file.


\item
\textbf{Brownian}\\
\textit{TRUE}: Brownian motion will be considered
under certain temperature, 
\textbf{kt} should be set in
\textbf{mcf\_io\_config\_file} file.
Currently Brownian motion only works for 
\textbf{rhs\_density\_type} = 
\textit{2, 3}

\item
\textbf{Newtonian}\\
Logical value indicating if we are
simulating Newtonian or Non-Newtonian 
fluid (e.g. viscoelastic oldroyd-B model).
Currently it only works for 
\textbf{rhs\_density\_type} = 
\textit{2, 3}.

\item
\textbf{p\_energy}\\
Logical value indicating if potential
energy needs to be calculated.

\item
\textbf{write\_restart} \\
Write particles' information during simulation
for restarting~(logical variable).
Set \textbf{write restart }paramters accordingly in
\textbf{mcf\_io\_config\_file} file.

\end{itemize}

\subsection{\textbf{mcf\_physics\_config\_file}~(\textit{physics\_config.mcf})}
This files contains the physical parameters
for the simulation.


\begin{center}
\underline{\textlangle complex fluids \textrangle}
\end{center}

\begin{itemize}

\item\textbf{ num\_species}\\
If set to \textit{1}, colloids will be ignored,
there is only fluid;
If set to \textit{2}, colloids must be given later. 
Remark :
wall boundaries are \textbf{not} considered 
as another different species.

\end{itemize}


\begin{center}
\underline{\textlangle space \textrangle}
\end{center}

\begin{itemize}
 
\item 
\textbf{num\_dim} \\
Space dimensions. 
Either \textit{2} or \textit{3}.

\item 
\textbf{min\_phys} \\
Bottom boundary coordinates \textit{min\_x, min\_y~(, min\_z)}.

\item 
\textbf{max\_phys} \\
Top boundary coordinates \textit{max\_x, max\_y~(, max\_z)}.

\item
\textbf{lattice}  \\
Type of lattice for generating particles configuration.
\begin{itemize}
\item
2D : \textit{1} square; \textit{2} staggerd~(not available); \textit{3} hexagonal.
\item
3D : \textit{1} simple cubic lattice; \textit{2} body centered lattice~(not available);
\textit{3 }face centered lattice~(not available).
\end{itemize}
\item
\textbf{num\_part}  \\
Initial estimated number of particles 
in x, y(, z) directions,
supposing particles are on lattice.

\item 
\textbf{cut\_off} \\
cut\_off of compact support domain \textbf{$r_c$}.

\end{itemize}


\begin{center}
\underline{\textlangle time scale \textrangle}
\end{center}

\begin{itemize}
\item 
\textbf{dt }\\
Time step.
If negative value is given,
dt will be calculated according to
CFL,
viscous diffusion,
and magnitude of particle accerleartion~\cite{Morris1997}
in the simulation.

\item 
\textbf{step\_start} \\
Number of time step to start.

\item 
\textbf{step\_end} \\
Number of time step to end.
However,  the bigger one of
\textbf{step\_end} $\times$ \textbf{dt} and 
\textbf{time\_end} will be chosen
(\textbf{dt} is time step used in the simulation).

\item 
\textbf{time\_start} \\
Time to start.

\item 
\textbf{time\_end} \\
Time to end.

\end{itemize}

\begin{center}
\underline{\textlangle physical properties \textrangle}
\end{center}

\begin{itemize}
 
\item 
\textbf{rho} \\
Initial density of solvent.

\item 
\textbf{eta} \\
Absolute/dynamic~(shear) viscosity.

\item 
\textbf{ksai} \\
Bulk viscosity used in 
Espa\~{n}ol and Revenga~\cite{Espanol2003}'s
formulation for compressible flow~(not available).

\item 
\textbf{kt}   \\
Boltzmann constant $\times$ Temperature,
used for Brownian motion in SDPD.

\item 
\textbf{c}  \\
Artificial sound speed.  

\item 
\textbf{rho\_ref} \\
Reference density \textbf{$\rho_{ref}$}; 
If dynamic density referece is required
\textbf{$\rho_{min}$} will be calculated 
in the simulation and
taken as reference density.

\item 
\textbf{gamma}  \\
Exponenet in the equation of state.

\end{itemize}


\begin{center}
\underline{\textlangle relax run/pre-run parameters \textrangle}
\end{center}

\begin{itemize}
 
\item 
\textbf{relax\_type}  \\
Relaxation criterion:
\begin{itemize}
 \item 
\textit{1} according to given step/time.
 \item
\textit{2} according to desired disorder level.
\end{itemize}
\item 
\textbf{step\_relax}   \\
Steps for relax run.

\item 
\textbf{time\_relax}   \\
Time for relax run.

\item 
\textbf{disorder\_level} \\
Desired disorder level [\textit{0, 1}].\\
\textit{0}: completely disorder;
\textit{1}: on lattice;


\item 
\textbf{kt\_relax}  \\
Boltzmann constant $\times$ Temperature for SDPD pre-run.

\item 
\textbf{c\_relax}   \\
Sound speed for relax run.

\end{itemize}


\begin{center}
\underline{\textlangle external force \textrangle}
\end{center}

\begin{itemize}
 
\item 
\textbf{body\_force\_type} \\
Type of body force
\begin{itemize}
 \item \textit{0} no body force.
 \item \textit{1} constant in one direction.
 \item \textit{ 2} constant in two direction. 
 \item \textit{3} $F_0\times sin(k \times y)$.
\end{itemize}

\item 
\textbf{body\_force}  \\
Body force $F_0$ applied to all solvent particles.

\item
\textbf{body\_force\_d}    \\
Increment of body force, 
when fixed flow velocity strategy is used.

\end{itemize}


\begin{center}
\underline{\textlangle flow velocity \textrangle}
\end{center}

\begin{itemize}
 
\item 
\textbf{flow\_direcion} \\
Direction of desird flow.

\item 
\textbf{flow\_width}    \\
The box width to calculate the flow velocity.
[0,\textbf{flow\_width}]
\item 
\textbf{flow\_v}  \\
Imposed average flow velocity for [0,\textbf{flow\_width}],
when \textit{TRUE} is set to \textbf{flow\_velocity\_fixed} 
in \textbf{mcf\_ctrl\_config\_file} file.

\item 
\textbf{flow\_adjust\_freq} \\
The frequency to adjust bodyforce to get 
expected flow velocity.

\end{itemize}

\begin{center}
\underline{\textlangle non-Newtonian viscoelastic Oldroyd-B parameters \textrangle}
\end{center}
 
\begin{itemize}
 
\item  
\textbf{tau} \\
relaxation time of polymer molecules.

\item 
\textbf{n\_p} \\
number of dumbells per unit volume.

\item 
\textbf{kt\_p} \\
Boltzmann constant $\times$ Temperature for dumbell.

\item  
\textbf{eigen\_dynamics} \\
Logical value indicating if we are
using eigen-dynamics way.

\item 
\textbf{eval} \\
Initial eigenvalues for eigen-dynamics.

\item 
\textbf{evec}  \\
Initial eigenvectors for eigen-dynamics.
array notation of 2D in order :
% ev1_x, ev1_y, ev2_x, ev2_y
% array notation of 3D in order :
% ev1_x, ev1_y, ev1_z, ev2_x, ev2_y, ev2_z,
% ev3_x, ev3_y, ev3_z.

\end{itemize}

\begin{center}
\underline{\textlangle Boundary condition of physical domain \textrangle}
\end{center}

\begin{itemize}

\item  
\textbf{bcdef} \\
Boudary condition definition for different sites
\begin{itemize}
 \item 2D: 
  \textit{$x_{min}, x_{max}, y_{min}, y_{max}$}.
 \item 3D:
  \textit{$x_{min}, x_{max}, y_{min}, y_{max}, z_{min}, z_{max}$}.
\end{itemize}
Theire values are integer numbers
\begin{itemize}
 \item  \textit{1} 
periodic boundary condition.
 \item  \textit{3}
symmetry boundary condition.
\textbf{symmetry} must be set to \textit{FALSE}
in \textbf{mcf\_ctrl\_config\_file} file.
\item \textit{7}
wall boundary, outside computational domain,
handeled by PPM using symmetry/mirror boundaries.
\textbf{symmetry}=\textit{FALSE} must be set
in \textbf{mcf\_ctrl\_config\_file} file.
\item  \textit{9}
solid wall boundary, outside of initial computational 
domain created by MCF extending computational domains.
 \item \textit{10} 
 Leeds-Edwards boundary.
\end{itemize}

\item 
\textbf{shear\_type} \\
Type of shear:
\begin{itemize}
\item \textit{1} normal.
\item \textit{2} oscillating with cosine function.
\end{itemize}

\item 
\textbf{shear\_v} \\
Initial magnitude of shear velocity for different sides.
\begin{itemize}
\item 2D: shear velocity of x side(left, right), in y direction;
shear velocity of y side(down, up), in x direction;
\item 3D: shear velocity of x side(left, right), in y-z direction;
shear velocity of y side(down, up), in x-z direction;
shear velocity of z side(down, up), in x-y direction;
\end{itemize}

\item 
\textbf{shear\_freq} \\
Frequecy of oscillating shear.

\item 
\textbf{wall\_rho} \\
Density type of wall:
\begin{itemize}
\item \textit{0} constant.
\item \textit{1} calculated and renormalized.
\end{itemize}

\item 
\textbf{wall\_noslip} \\
Order for different walls
\begin{itemize}
\item
2D: $W_{x1}, W_{x2}, W_{y1}, W_{y2}$;
\item
3D: $W_{x1}, W_{x2}, W{y1}, W_{y2}, W_{z1}, W_{z2}$;
\end{itemize}
No slip type is an integer number:
\begin{itemize}
 \item \textit{1} frozen 
 \item \textit{2} Morris et al. 1997~\cite{Morris1997}
\end{itemize}

\end{itemize}
 
\begin{center}
\underline{\textlangle colloid's parameters \textrangle}
\end{center}


Note : The order of parameters are fixed here, 
which should be followed.

\begin{itemize}
 
\item  
\textbf{num\_colloid} \\
Number of colloids.

\item 
\textbf{colloid\_rho}  \\
Density type :
\begin{itemize}
\item
\textit{0} constant.
\item 
\textit{1} calculated.
\end{itemize}

\item 
\textbf{coll\_x}   \\
Initial geometrical center of the colloid.

\item 
\textbf{coll\_translate} \\
Indicate if the colldoid can translate freely.

\item 
\textbf{coll\_v}\\
Initial translating velocity of center of the colloid.

\item 
\textbf{coll\_rotate}
Indicate if the colldoid can rotate freely.

\item 
\textbf{coll\_omega}  \\
Initial rotating velocity of the colloid, always 3D vector.

\item 
\textbf{coll\_shape} \\
Shape of the colloidal particle:
\begin{itemize}
\item \textit{1} disk~(2D)/sphere~(3D).
\item \textit{2} ellipse~(2D)/ellpsoid~(3D).
\item \textit{3} arbitrary~(2D).
\end{itemize}

\item  
\textbf{coll\_ra} \\
Initial (major) radius of the colloid.\\
(For dis/sphere, used as radius.)

\item 
\textbf{coll\_rb} \\
Initial (minor) radius of the colloid.\\
(For ellipse~(2D), used as minor axis;
for arbitray~(2D), used as fluctuating magnitude.)

\item 
\textbf{coll\_phi} \\
Initial angle between major axis and $x+$ coordinate.

\item 
\textbf{coll\_freq} \\
Useful for arbitray shape, 
determining the roughness/frequency.
Must be integer.

\item 
\textbf{coll\_m} \\
Mass of the colloid, 
not needed to be given and
will be calculated according to its volume and density.
Should be given for a restarted run.

\item
\textbf{coll\_mmi} \\
Mass momentum inertia of the colloid, 
not needed to be given and 
will be calculated according to its distribution of mass.
Should be given for a restarted run.

\item
\textbf{coll\_pace} \\
Type of placement for colloidal boundary particles:
\begin{itemize}
\item
\textit{1} on lattice.
\item 
\textit{2} parallel to the surface, 
with fixed distance on each layer.
\item 
\textit{3} parallel to the surface,
with fixed number of particles on each layer.
\end{itemize}

\item
\textbf{coll\_noslip} \\
No slip type for the colloidal surface:
\begin{itemize}
\item
\textit{1} frozen.
\item 
\textit{2} Morris et al. 1997.
\item
\textit{3} Zhu et al. 1999.
\end{itemize}

\item 
\textbf{coll\_body\_force}  \\
Body force on colloid.

\end{itemize}

\subsection{\textbf{mcf\_io\_config\_file}~(\textit{io\_config.mcf})}


\begin{center}
\underline{\textlangle particles configuration, if reading from external files \textrangle}
\end{center}

\begin{itemize}
 \item \textbf{read\_particles\_file} \\
Name of particles file for reading. 
 \item \textbf{read\_particles\_fmt} \\
Format of the file. 
  \begin{itemize}
  \item
  FORMATTED~(ASCII text)
  \item
  UNFORMATTED~(binary)
  \end{itemize}
\end{itemize}

\begin{itemize}
          
\item \textbf{read\_conformation\_file} 
(non-Newtonian Viscoelastic fluids)\\
Name of conformation tensor file for reading.

\item \textbf{read\_conformation\_fmt}
(non-Newtonian Viscoelastic fluids) \\
Format of the file.
\begin{itemize}
\item
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}

\end{itemize}

\begin{center}
\underline{\textlangle output relax run/pre-run particles \textrangle}
\end{center}

\begin{itemize}
           
\item \textbf{output\_relax\_particles\_file} \\
Prefix name of ouput files. 
\textit{timestep.out} will be appended.
\item\textbf{ output\_relax\_particles\_fmt} \\
Format of output file.

\begin{itemize}
 \item 
FORMATTED~(ASCII text)
 \item
UNFORMATTED~(binary)
\end{itemize}

\item\textbf{output\_relax\_particles\_freq }\\
Frequency for writing output files
(in computer time steps).
\end{itemize}

\begin{center}
\underline{\textlangle output particles results \textrangle}
\end{center}

\begin{itemize}
 \item 
\textbf{output\_particles\_file} \\
Prefix name of ouput files. 
\textit{timestep.out} will be appended.

\item 
\textbf{output\_particles\_fmt} \\
Format of output file
\begin{itemize}
\item
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}
\item \textbf{output\_particles\_freq}\\
Frequency for writing output files
(in computer time steps).
\end{itemize}

\begin{itemize}
 \item \textbf{output\_conformation\_file} \\
Prefix name of conformation files. 
\textit{timestep.out} will be appended.
\item \textbf{output\_conformation\_fmt}  \\
Format of conformaiont file. 
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}
\item \textbf{output\_conformation\_freq} \\
Frequency for writing conformation files
(in computer time steps).
\end{itemize}

\begin{center}
\underline{\textlangle output relax run/pre-run statistics \textrangle}
\end{center}

\begin{itemize}
\item 
\textbf{statistic\_relax\_file} \\
Name of statistics output file.
\item  \textbf{statistic\_relax\_fmt} \\
Format of statistics output file.
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}

\item \textbf{statistic\_relax\_freq} \\
Frequency for writing statistics output
(in computer time steps).
\end{itemize}

\begin{center}
\underline{\textlangle output statistics \textrangle}
\end{center}

\begin{itemize}
\item  \textbf{statistic\_file} \\
Name of statistics output file.
\item \textbf{statistic\_fmt}\\
Format of statistics output file.
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}

\item \textbf{statistic\_freq} \\
Frequency for writing statistics output
(in computer time steps).
\end{itemize}


\begin{center}
\underline{\textlangle output boundary information, if there is wall\textrangle}
\end{center}


\begin{itemize}
\item \textbf{boundary\_file }\\
Prefix of name of boundary output file.
\item  \textbf{boundary\_fmt} \\
Format of boundary output file. 
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}
\item \textbf{boundary\_freq}\\
Frequency for writing boundary output
(in computer time steps).
\end{itemize}

\begin{center}
\underline{\textlangle output colloid(s) information, if there is colloid\textrangle}
\end{center}

\begin{itemize}
\item \textbf{colloid\_file} \\
Prefix of name of colloid output file.
\item  \textbf{colloid\_fmt} \\
Format of colloid output file. One of
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}
\item \textbf{colloid\_freq} \\
Frequency for writing colloid output
(in computer time steps).
\end{itemize}

\begin{center}
\underline{\textlangle write information for restarting \textrangle}
\end{center}

\begin{itemize}
 \item \textbf{restart\_particles\_relax\_file} \\
Prefix of the name of restart file for particles 
\textit{time step.dat} will be appended.

\item \textbf{restart\_particles\_relax\_fmt} \\
format of restart particles file:
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}

\item \textbf{restart\_relax\_freq} \\
Frequency for writing restart files
in computer time steps.
(physics and particles have same frequencey)

\end{itemize}


\begin{itemize}
\item \textbf{restart\_physics\_file} \\
Prefix of the name of restart file for physics 
\textit{time step.dat} will be appended.

\item \textbf{restart\_physics\_fmt} \\
Format of read physics file:
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}

\item \textbf{restart\_particles\_file} \\
Prefix of the name of restart file for particles 
\textit{time step.dat} will be appended.


\item \textbf{restart\_particles\_fmt } \\
Format of restart particles file:
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}
\item \textbf{restart\_conformation\_file} \\
Prefix of the name of restart file for 
conformation tensory, 
\textit{time step.dat} will be appended.

\item \textbf{restart\_conformation\_fmt} \\
Format of restart conformation file:
\begin{itemize}
 \item 
FORMATTED~(ASCII text)
\item
UNFORMATTED~(binary)
\end{itemize}

\item \textbf{restart\_freq} \\
Frequency for writing restart files
in computer time steps.
(physics and particles have same frequencey)

\end{itemize}

\section{Running simulation}

\subsection{Local workstation}
\subsubsection{Serial run}
One can start the simulation 
with default control configuration file
by simply typing in command line \\ \\
$:>$ \textbf{./mcf }\\ \\
then file \textbf{mcf\_ctrl\_config\_file}=\textit{ctrl.mcf},
which is located in the same directory,
will be used as control configuration file.
The name~(\textit{ctrl.mcf}) is hard-coded in MCF.
In this case,
\textbf{mcf\_physics\_config\_file} and
\textbf{mcf\_io\_config\_file} must be defined
inside \textit{ctrl.mcf} also,
to specify physics and IO configuration files.

If one changed the value of \textbf{mcf\_ctrl\_config\_file},
i.e., change the name of \textit{ctrl.mcf} to \textit{FFFF}, 
he can start the simulation by \\ \\
$:>$ \textbf{./mcf } \textit{FFFF} \\ \\
Now \textit{FFFF} is the new control configuration file,
which must also define \\
\textbf{mcf\_physics\_config\_file} and
\textbf{mcf\_io\_config\_file}.

Since the simulation will print out 
the component details/parameters
onto standard output~(screen)
while running,
one can use \\ \\
$:>$ \textbf{./mcf } $\mid$ \textbf{tee} \textit{mcf\_std.out} \\ \\
to save the print-out into file \textit{mcf\_std.out} also,
which can be used later for reference.

\subsubsection{Parallel run}
Make sure {\bf mpd} is running in background as a dameon
for MPI applications.
Then start \textbf{mcf} in the same way as before,
except that give extra parallel information of using multiple processes\\ \\
$:>$ \textbf{mpiexec -n} \textit{NUM} \textbf{./mcf } $\mid$ \textbf{tee} \textit{mcf\_std.out}\\ \\
\textit{NUM} is the number of processes being used.

\subsection{Altix 4700 Supercomputer on LRZ}
Since PBS system is used on supercomputer,
one must edit a script decribing the job
before actually run any simulation.
The typical script is following:
\begin{verbatim}
#!/bin/bash 
#PBS -o /ptmp1/pr95zi/lu64yuz2/mcf_run/standard.out
#PBS -j oe 
#PBS -S /bin/bash 
#PBS -l select=256:ncpus=1:mem=500mb
#PBS -l walltime=48:00:00 
#PBS -N lub3D
#PBS -M xin.bian@aer.mw.tum.de 
#PBS -m abe 
. /etc/profile.d/modules.sh 
cd /ptmp1/pr95zi/lu64yuz2/mcf_run/
mpiexec -n 256 ./mcf > mcf_std.out
\end{verbatim}
For more details,
please
check
\url{http://www.lrz.de/services/compute/hlrb/}
\subsection{SupMUC Supercomputer on LRZ}

\subsubsection{IBM MPI (default)}
\begin{verbatim}
 #!/bin/bash
#
#@ job_type = parallel
#@ class = general
#@ node  = 4
#@ total_tasks=128
#@ wall_clock_limit = 48:00:00
#@ job_name = 20_20_20_x0k4_ellipsoid
#@ network.MPI = sn_all,not_shared,us
#@ initialdir = /work/pr32ma/lu64yuz3/shear_free_ellipsoid/lattice/20_20_20_x0k4/
#@ error = job$(jobid).err
#@ notification=always
#@ notify_user=xin.bian@aer.mw.tum.de
#@ queue
. /etc/profile
. /etc/profile.d/modules.sh
mpiexec -n 128 ./mcf | tee mcf_std.out
\end{verbatim}

\subsubsection{Intel MPI }
\begin{verbatim}
 #!/bin/bash
#
#@ job_type = MPICH
#@ class = general
#@ node  = 4
#@ total_tasks=128
#@ wall_clock_limit = 48:00:00
#@ job_name = 20_20_20_x0k4_ellipsoid
#@ network.MPI = sn_all,not_shared,us
#@ initialdir = /work/pr32ma/lu64yuz3/shear_free_ellipsoid/lattice/20_20_20_x0k4/
#@ error = job$(jobid).err
#@ notification=always
#@ notify_user=xin.bian@aer.mw.tum.de
#@ queue
. /etc/profile
. /etc/profile.d/modules.sh
module unload mpi.ibm
module load mpi.intel
mpiexec -n 128 ./mcf | tee mcf_std.out
\end{verbatim}


\section{Output data files}

\subsection{\textbf{output\_particles\_relax\_file}\\
(\textit{mcf\_init\_particlesNNN.out})}
\textit{NNN} represent the number of steps in the simulation for this output file.
This file contains the fundamental quantities of each particle
at the end of step \textit{NNN}.
\textbf{$[x, y(, z), v_x, v_y(, v_z), rho, m, p_{id}, s_{id}]$}.
Note that \textbf{$rho$} can be number density or mass density,
depending on the \textbf{rhs\_density\_type}.
Both \textbf{$p_{id}$} and \textbf{$s_{id}$} are integer numbers.
\textbf{$p_{id}$} is particle ID and
unique for each particle.
\textbf{$s_{id}$} is species ID.

For solvent particle \textbf{$s_{id}$}=\textit{0}.
For colloidal boundary particle \textbf{$s_{id}$}=\textit{1...\textit{MM}}.
\textit{MM} is the total number of colloids
in the simulation.
For wall boundary particle \textbf{$s_{id}$}=\textit{-1, -2, -3, -4,( -5, -6)},
denpending on which wall it belongs to.

\subsection{\textbf{output\_particles\_file}\\
(\textit{mcf\_particlesNNN.out})}
\textit{NNN} represent the number of steps in the simulation for this output file.
This file contains the fundamental quantities of each particle
at the end of step \textit{NNN}.
\textbf{$[x, y(, z), v_x, v_y(, v_z), \rho, m, {id}_p, {id}_s]$}.
Note that \textbf{$\rho$} can be number density or mass density,
depending on the \textbf{rhs\_density\_type}.
Both \textbf{${id}_p$} and \textbf{${id}_s$} are integer numbers.
\textbf{${id}_p$} is particle ID and
unique for each particle.
\textbf{${id}_s$} is species ID.

For solvent particle \textbf{${id}_p$}=\textit{0}.
For colloidal boundary particle \textbf{${id}_s$}=\textit{1...\textit{MM}}.
\textit{MM} is the total number of colloids
in the simulation.
For wall boundary particle \textbf{${id}_s$}=\textit{-1, -2, -3, -4,( -5, -6)},
denpending on which wall it belongs to.

If the force per unit mass is set to output,
there are more columns
\textbf{[$f_x, f_y(, f_z)$]}.
If the individual forces per unit mass are set to output,
there are more columns
\textbf{[$f^p_x, f^p_y(, f^p_z),f^v_x, f^v_y(, f^v_z)(,f^r_x, f^r_y(, f^r_z))$]}.


If the stress tensor for each particle is set to output,
there are more columns
\textbf{[$\sigma_{xy}, \sigma_{yx}$]}.
If the individual stress tensors for each particle are set to output,
there are more columns
\textbf{[$\sigma^p_{xy}, \sigma^p_{yx}, \sigma^v_{xy}, \sigma^v_{yx}(,\sigma^r_{xy}, \sigma^r_{yx})$]}.


\subsection{\textbf{output\_conformation\_file}\\
(\textit{mcf\_conformationNNN.out})}
\textit{NNN} represent the number of steps in the simulation for this output file.
This file contains the fundamental quantities of each particle
at the end of step \textit{NNN}.
\textbf{$[x, y; p_{id}; 
vgt_{xx}, vgt_{xy}, vgt_{yx}, vgt_{yy}; 
ct_{xx}, ct_{xy}, ct_{yx}, ct_{yy}; 
pt_{xx}, pt_{xy}, pt_{yx}, pt_{yy}]$}.

Note that 
\textbf{$p_{id}$} is particle ID and
unique for each particle;
\textbf{$vgt$} is velocity gradient tensor;
\textbf{$ct$} is conformation tensor;
\textbf{$pt$} is pressure tensor.


\subsection{\textbf{statistic\_relax\_file}\\
(\textit{mcf\_init\_statistic.dat})}
For relax run/ pre-run statistics.

\textbf{[step, time, kinetic energy]}.

\subsection{\textbf{statistic\_file}\\
(\textit{mcf\_statistic.dat})}
Statistics output file,
which contains overall quantities of all particles
or particles in certain region.

\textbf{[step, time, kinetic energy, momentum: $mom_x, mom_y(, mom_z)$]}.

If flow average velocity in certain region is required, 
there are more colums:

\textbf{[velocity: $v_x, v_y(, v_z)$]}.

If reference density if calculated dynamically,
there are more colums:

\textbf{[density: $\rho_{min}, \rho_{max}$]}.

If stress tensor is set to output:

\textbf{[stress tensor: $\sigma_{xy}, \sigma_{yx}$]}.

If individual stress tensors are set to output:

\textbf{[stress tensor: 
$\sigma^p_{xy}, \sigma^p_{yx},
\sigma^v_{xy}, \sigma^v_{yx}
(,\sigma^r_{xy}, \sigma^r_{yx})$]}.

\subsection{\textbf{boundary\_file}\\
(\textit{mcf\_boundary.dat})}
Boundary~(wall) output file:

Most of the simulations, we have at maximum two walls.


2D: \textbf{[step, time, force on walls:  $F^1_x, F^1_y, F^2_x, F^2_y$]}.

3D: \textbf{[step, time, force on walls:  $F^1_x, F^1_y, F^1_z, F^2_x, F^2_y, F^2_z$]}.

If the code is compiled to output individual forces (pressure, viscous, random),
then there are more columns in the output:

2D: \textbf{[$F^{1p}_x, F^{1p}_y, 
F^{1v}_x, F^{1v}_y
(,F^{1r}_x, F^{1r}_y),
F^{2p}_x, F^{2p}_y, 
F^{2v}_x, F^{2v}_y
(,F^{2r}_x, F^{2r}_y)$]}.

3D: \textbf{[$F^{1p}_x, F^{1p}_y, F^{1p}_z, 
F^{1v}_x, F^{1v}_y, F^{1v}_z
(,F^{1r}_x, F^{1r}_y, F^{1r}_z),\\
F^{2p}_x, F^{2p}_y, F^{2p}_z, 
F^{2v}_x, F^{2v}_y, F^{2v}_z
(,F^{2r}_x, F^{2r}_y, F^{2r}_z)$]}.

For non-Brownian simulation, the random force component is absent.

\subsection{\textbf{colloid\_file}\\
(\textit{mcf\_colloidM.dat})}
\textit{M} is number index of a colloidal particle.
\textit{MM} is the total number of colloidal particles.

Whether quantities inside $[~]$ are present depends
on whether colloid is translational or rotational.

2D:
\textbf{$step, time, [x, y], [v_x, v_y],
F_x, F_y$},
\textbf{$[\phi],[\omega_z], 
[T_z]$}.

3D:
\textbf{$step, time, [x, y, z], [v_x, v_y, v_z],
F_x, F_y, F_z$},\\
\textbf{$[rm_{xx},rm_{yx},rm_{zx},rm_{xy},rm_{yy},rm_{zy},rm_{xz},rm_{yz},rm_{zz}]$},
\textbf{$[\omega_x, \omega_y, \omega_z],[T_x, T_y, T_z]$},
where $rm$ stands for rotation matrix.

\subsection{\textbf{restart\_physics\_file}\\
(\textit{mcf\_restart\_physicsQQQ.mcf})}


\subsection{\textbf{restart\_particles\_file}\\
(\textit{mcf\_restart\_particlesQQQ.dat})}


\subsection{\textbf{restart\_conformation\_file}\\
(\textit{mcf\_restart\_conformationQQQ.dat})}

\bibliography{bibdata}
\bibliographystyle{unsrt}
\end{document}  